<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>إنشاء حساب</title>
 <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Load reCAPTCHA v3 script with your site key -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LdxBKErAAAAAFVlC71oXUICVYSgzNeDFEyxQ7fJ"></script>
  <style>
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #0a1b2a 0%, #112f4a 100%); color: #e0e6f0; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 1.5rem; }
    .signup-container { background: rgba(20, 45, 75, 0.95); padding: 2rem 2.5rem; border-radius: 15px; box-shadow: 0 0 25px rgba(255, 59, 59, 0.4), inset 0 0 10px rgba(255, 59, 59, 0.2); width: 100%; max-width: 420px; text-align: center; }
    .signup-container h1 { color: #ff3b3b; font-size: 2rem; font-weight: 800; text-shadow: 0 0 8px #ff3b3b; margin-bottom: 0.5rem; }
    .subtitle { font-size: 1rem; color: #d1d9efcc; margin-bottom: 1.5rem; }
    .signup-form .form-group { margin-bottom: 1.2rem; text-align: right; }
    .signup-form label { display: block; margin-bottom: 0.4rem; font-weight: 700; color: #ffdede; }
    .signup-form input { width: 100%; padding: 0.6rem 0.8rem; border-radius: 8px; border: none; background: rgba(255, 255, 255, 0.08); color: #fff; font-size: 1rem; outline: none; box-shadow: inset 0 0 5px rgba(255, 59, 59, 0.4); transition: box-shadow 0.3s ease, background 0.3s ease; }
    .signup-form input:focus { background: rgba(255, 255, 255, 0.12); box-shadow: 0 0 8px #ff3b3b, inset 0 0 8px #ff3b3b; }
    .signup-btn { width: 100%; padding: 0.75rem; font-size: 1.1rem; font-weight: 800; background: #ff3b3b; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 0 15px #ff3b3baa; transition: background 0.3s ease, box-shadow 0.3s ease; }
    .signup-btn:hover { background: #ff6666; box-shadow: 0 0 25px #ff6666bb; }
    .login-link { margin-top: 1rem; font-size: 0.95rem; }
    .login-link a { color: #ff3b3b; font-weight: 700; text-decoration: none; }
    .login-link a:hover { color: #ff6666; text-shadow: 0 0 6px #ff6666; }
    #cg-toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: 20px; background: #222; color: #fff; padding: 0.6rem 0.9rem; border-radius: 8px; box-shadow: 0 6px 18px rgba(0,0,0,0.5); opacity: 0; transition: opacity .2s; z-index: 99999; pointer-events: none; }
    @media (max-width:480px) { .signup-container{ padding:1.3rem; } }
  
    /* ... your existing CSS ... */

  </style>

  <!-- Load Google reCAPTCHA script -->
</head>
<body>

<div class="signup-container">
  <h1>إنشاء حساب جديد</h1>
  <p class="subtitle">انضم إلينا الآن وابدأ رحلتك</p>

  <form id="signupForm" action="https://formspree.io/f/YOUR_FORM_ID" method="POST" class="signup-form" onsubmit="return onSubmitPrepare(event);">

    <!-- Your form inputs here -->
    <div class="form-group">
      <label for="username">اسم المستخدم</label>
      <input type="text" id="username" name="username" placeholder="أدخل اسم المستخدم" required>
    </div>

    <div class="form-group">
      <label for="email">البريد الإلكتروني</label>
      <input type="email" id="email" name="email" placeholder="example@email.com" required>
    </div>

    <div class="form-group">
      <label for="password">كلمة المرور</label>
      <input type="password" id="password" name="password" placeholder="••••••••" required>
    </div>

    <div class="form-group">
      <label for="confirm-password">تأكيد كلمة المرور</label>
      <input type="password" id="confirm-password" placeholder="••••••••" required>
    </div>

    <!-- Honeypot hidden input -->
    <div style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;">
      <label for="website">Website (leave blank)</label>
      <input type="text" id="website" name="website" autocomplete="off" tabindex="-1" />
    </div>

    <!-- Hidden input to hold recaptcha token -->
    <input type="hidden" id="recaptchaToken" name="recaptcha_token" />

    <input type="hidden" name="_subject" value="Signup from site (demo)">

    <button type="submit" class="signup-btn">تسجيل</button>
    <p class="login-link">لديك حساب بالفعل؟ <a href="login.html">تسجيل الدخول</a></p>
  </form>
</div>

<div id="cg-toast" role="status" aria-live="polite"></div>

<script>
 (function(){
    const form = document.getElementById('signupForm');
    const toast = document.getElementById('cg-toast');
    const submitBtn = form.querySelector('.signup-btn');

    function showToast(msg, ms = 2600) {
      toast.textContent = msg;
      toast.style.opacity = '1';
      setTimeout(() => { toast.style.opacity = '0'; }, ms);
    }

    function bufferToHex(buffer) {
      const bytes = new Uint8Array(buffer);
      return Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    function emailValid(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

    function setSubmitting(state) {
      submitBtn.disabled = state;
      submitBtn.style.opacity = state ? '0.7' : '1';
      if (state) {
        submitBtn.dataset.origText = submitBtn.textContent;
        submitBtn.textContent = 'جارٍ الإرسال...';
      } else {
        submitBtn.textContent = submitBtn.dataset.origText || submitBtn.textContent;
      }
    }

    window.onSubmitPrepare = async function(e) {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();
      const passwordEl = document.getElementById('password');
      const confirmEl = document.getElementById('confirm-password');
      const password = passwordEl.value || '';
      const confirm = confirmEl.value || '';
      const honeypot = document.getElementById('website').value;

      if (honeypot) {
        showToast('Spam detected.');
        return false;
      }

      if (!username || username.length < 2) { showToast('Please enter a valid username.'); document.getElementById('username').focus(); return false; }
      if (!email || !emailValid(email)) { showToast('Please enter a valid email.'); document.getElementById('email').focus(); return false; }
      if (!password || password.length < 6) { showToast('Password must be at least 6 characters.'); passwordEl.focus(); return false; }
      if (password !== confirm) { showToast('Passwords do not match.'); confirmEl.focus(); return false; }

      setSubmitting(true);

      try {
        // Hash password
        const enc = new TextEncoder().encode(password);
        const digest = await crypto.subtle.digest('SHA-256', enc);
        const hexHash = bufferToHex(digest);
        passwordEl.value = hexHash;
        confirmEl.value = '';
      } catch (err) {
        console.warn('Hashing failed, sending plain password (not recommended):', err);
      }

      // Execute reCAPTCHA v3 for "signup" action
      grecaptcha.ready(function() {
        grecaptcha.execute('6LdxBKErAAAAAFVlC71oXUICVYSgzNeDFEyxQ7fJ', {action: 'signup'}).then(function(token) {
          document.getElementById('recaptchaToken').value = token;
          form.submit();
        });
      });

      return false;
    };
  })();
</script>

</body>
</html>
